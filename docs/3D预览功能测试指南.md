# 🔬 3D预览功能测试指南

## 🎯 **测试目的**
验证CIF转USDZ工具的3D预览功能是否正常工作，包括：
- Three.js库加载
- CIF文件解析
- 3D结构渲染
- 二维码生成
- AR预览功能

## 🌐 **测试页面**

### 1. **调试页面** (推荐先测试)
**地址**: http://localhost:8000/debug_3d.html

**功能**: 
- 检测Three.js和OrbitControls加载状态
- 测试基础3D场景渲染
- 验证自定义预览类功能
- CIF文本解析测试

**预期结果**:
```
✅ Three.js已成功加载
✅ OrbitControls已加载  
✅ 基础3D场景运行正常
✅ 自定义预览类工作正常
```

### 2. **主页面** (完整功能测试)
**地址**: http://localhost:8000

## 📋 **详细测试步骤**

### 第一步：打开调试页面
1. 访问 http://localhost:8000/debug_3d.html
2. **观察各项测试结果**:
   - 如果全部显示 ✅ 绿色 → 基础环境正常
   - 如果有 ❌ 红色 → 记录错误信息

### 第二步：测试主页面
1. 访问 http://localhost:8000
2. **打开浏览器开发者工具** (F12)
3. **查看控制台输出**，应该看到：
   ```
   🔧 开始初始化3D预览...
   ✅ Three.js已加载
   🚀 使用高级预览
   ✅ 高级预览初始化成功
   ```

### 第三步：上传CIF文件测试
1. **选择文件**: 点击"选择CIF文件"，选择 `examples/simple_crystal.cif`
2. **观察预览区域**:
   - 应该自动显示预览区域
   - 页面自动滚动到预览区域
   - 应该看到"3D结构预览已加载"提示

3. **检查3D渲染**:
   - 预览区域应该显示3D晶体结构
   - 可以用鼠标拖拽旋转、滚轮缩放
   - 原子应该显示为不同颜色的球体

### 第四步：转换功能测试
1. **点击"开始转换"按钮**
2. **观察进度条**: 应该显示转换进度
3. **等待转换完成**: 应该看到"转换完成！二维码已生成"提示
4. **检查结果区域**:
   - 应该出现二维码
   - 下载链接可用
   - 转换信息正确显示

## 🔍 **故障排除**

### 如果3D预览空白:
1. **检查控制台错误**:
   ```javascript
   // 打开F12，查看Console选项卡
   // 寻找以下类型的错误：
   - Three.js加载失败
   - AdvancedCrystalPreview未定义
   - CIF解析错误
   ```

2. **常见错误及解决方案**:
   
   **错误**: `THREE is not defined`
   **解决**: 网络问题，Three.js CDN无法访问
   ```html
   <!-- 检查这行是否加载 -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
   ```

   **错误**: `AdvancedCrystalPreview is not defined`
   **解决**: 自定义预览类未加载
   ```html
   <!-- 检查这些文件是否加载 -->
   <script src="/static/js/advanced_crystal_preview.js"></script>
   <script src="/static/js/app.js"></script>
   ```

   **错误**: CIF解析失败
   **解决**: 检查CIF文件格式，确保包含必要的字段

### 如果二维码不显示:
1. **检查元数据传输**: 在Network选项卡查看转换请求的响应头
2. **检查转换状态**: 确保后端转换成功
3. **检查QRCode.js**: 确保二维码库正确加载

## 📊 **性能指标**

**正常性能表现**:
- 页面加载时间: < 3秒
- 3D预览初始化: < 2秒  
- CIF文件解析: < 1秒
- 转换时间: 3-10秒 (取决于文件大小)
- 二维码生成: < 1秒

## 🎉 **成功标志**

当以下全部完成时，3D预览功能正常工作：

✅ **基础环境**: Three.js和相关库正确加载  
✅ **预览显示**: 上传CIF文件后立即显示3D结构  
✅ **交互操作**: 可以旋转、缩放3D模型  
✅ **转换功能**: 能够成功转换为USDZ文件  
✅ **二维码生成**: 转换完成后显示AR二维码  
✅ **下载链接**: 可以下载生成的USDZ文件  

## 📱 **AR功能测试** (iOS设备)

1. **用iPhone/iPad扫描二维码**
2. **在Safari中打开链接**  
3. **点击3D模型文件**
4. **选择"在AR中查看"**
5. **在现实环境中查看3D模型**

---

## 🆘 **如果问题仍然存在**

请提供以下信息以便进一步诊断：
1. 浏览器控制台的完整错误信息
2. 网络选项卡中的请求/响应详情
3. 使用的浏览器版本和操作系统
4. 具体的测试步骤和观察到的现象

**📧 调试信息收集方式**:
```javascript
// 在控制台执行以获取详细信息
console.log('THREE:', typeof THREE);
console.log('AdvancedCrystalPreview:', typeof AdvancedCrystalPreview);
console.log('crystalPreview:', crystalPreview);
``` 